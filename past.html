<!DOCTYPE html>
<html>

<head>
    <title>Upcoming Events</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark bg-gradient">
            <a class="navbar-brand d-flex align-items-center " href="/"></a>
            <div class="logo-container">
                <h1 class="visually-hidden">Amazing Events</h1>
                <img src="./img/amazing_brand.png" alt="aevents" width="120" height="30">
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav gap-3 ms-md-auto mt-4 mb-lg-2 px-lg-5">
                    <li class="nav-item">
                        <a class="btn btn-primary" href="index.html" role="button">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-primary" href="upcoming.html" role="button">Upcoming
                            Events</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-dark bg-dark bg-gradient" href="past.html"  aria-current="page" role="button">Past Events</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-primary" href="contact.html" role="button">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-primary" href="stats.html" role="button">Stats</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
    <main>
        <!-- Carousel -->
        <div id="carouselExampleCaptions" class="carousel slide carousel slide carousel-fade">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active"
                    aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1"
                    aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2"
                    aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="./img/banner_6.jpg" class="d-block w-100" alt="...">
                    <div class="carousel-caption d-none d-md-block">
                        <h2 class="display-3">UPCOMING EVENTS</h2>
                        <p>Amazing Events</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="./img/banner_4.jpg" class="d-block w-100" alt="...">
                    <div class="carousel-caption d-none d-md-block">
                        <h2 class="display-3">UPCOMING EVENTS</h2>
                        <p>Some representative placeholder content for the second slide.</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="./img/banner_3.jpg" class="d-block w-100" alt="...">
                    <div class="carousel-caption d-none d-md-block">
                        <h2 class="display-3">UPCOMING EVENTS</h2>
                        <p>Some representative placeholder content for the third slide.</p>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
        <div class="input-group mt-2 mb-3">
            <input type="text" id="searchInput" class="form-control" placeholder="Type anything">
            <button class="btn btn-primary" type="button">Search</button>
        </div>

        <div id="cardContainer" class="card-container mt-2 row row-cols-1 row-cols-md-4 g-4"></div>
    </main>
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-1 border-top">
        <div class="col-md-4 d-flex align-items-center">
            <span class="mb-3 mb-md-0 text-muted ms-4">© 2023 Cohort 03</span>
        </div>
        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex me-4">
            <li class="me-4"><a class="text-muted" href="#"><i class="fab fa-whatsapp"></i></a></li>
            <li class="me-4"><a class="text-muted" href="#"><i class="fab fa-instagram"></i></a></li>
            <li class="me-4"><a class="text-muted" href="#"><i class="fab fa-facebook"></i></a></li>
        </ul>
    </footer>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function generateCard(event) {
            var card = `
                <div class="col">
                    <div class="card h-100">
                        <img src="${event.image}" class="card-img-top" alt="Card image">
                        <div class="card-body">
                            <h5 class="card-title">${event.name}</h5>
                            <p class="card-text">${event.description}</p>
                        </div>
                        <div class="card-footer d-flex justify-content-between align-items-center">
                            <h6 class="text-muted">$${event.price}</h6>
                            <a href="details.html?id=${event._id}" class="btn btn-primary">Details</a>
                        </div>
                    </div>
                </div>`;
            return card;
        }

        const cardContainer = document.getElementById('cardContainer');

        // Función para obtener los datos utilizando Fetch API
        function getData() {
            fetch('https://mindhub-xj03.onrender.com/api/amazing')
                .then(response => response.json())
                .then(data => {
                    var currentDate = new Date(data.currentDate);

                    data.events.forEach(function (event) {
                        var eventDate = new Date(event.date);

                        if (eventDate < currentDate) {
                            var card = generateCard(event);
                            cardContainer.innerHTML += card;
                        }
                    });

                    
                    document.getElementById('searchInput').addEventListener('input', () => {
                        search(data.events);
                    });
                })
                .catch(error => console.error('Error:', error));
        }

        // SEARCH
        function search(data) {
            var searchTerm = document.getElementById('searchInput').value.toLowerCase();
            var cardContainer = document.getElementById('cardContainer');

            cardContainer.innerHTML = '';

            if (searchTerm === '') {
                // Si el campo de búsqueda está vacío, mostrar todos los elementos
                data.forEach(function (event) {
                    var card = generateCard(event);
                    cardContainer.innerHTML += card;
                });
            } else {
                
                var found = false;
                data.forEach(function (event) {
                    if (event.name.toLowerCase().includes(searchTerm)) {
                        var card = generateCard(event);
                        cardContainer.innerHTML += card;
                        found = true;
                    }
                });

                if (!found) {
                    alert('No se encontraron resultados.');
                    document.getElementById('searchInput').value = ''; 
                    getData(); 
                }
            }
        }

        getData();
    </script>

</body>

</html>